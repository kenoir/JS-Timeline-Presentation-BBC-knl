<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=1024, user-scalable=no">

		<title>Embedded Timeline Presentation</title>

		<!-- Required stylesheet -->
		<link rel="stylesheet" href="core/deck.core.css">

		<!-- Extension CSS files go here. Remove or add as needed. -->
		<link rel="stylesheet" href="extensions/goto/deck.goto.css">
		<link rel="stylesheet" href="extensions/menu/deck.menu.css">
		<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
		<link rel="stylesheet" href="extensions/status/deck.status.css">
		<link rel="stylesheet" href="extensions/hash/deck.hash.css">
		<link rel="stylesheet" href="extensions/scale/deck.scale.css">

		<!-- Web fonts -->
		<link href='http://fonts.googleapis.com/css?family=Capriola' rel='stylesheet' type='text/css'>

		<!-- Style theme. More available in /themes/style/ or create your own. -->
		<link rel="stylesheet" href="themes/style/web-2.0.css">
		<link rel="stylesheet" href="themes/style/timeline.css">

		<!-- Transition theme. More available in /themes/transition/ or create your own. -->
		<link rel="stylesheet" href="themes/transition/horizontal-slide.css">

		<!-- Code formatting -->
		<link href="assets/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
		<script type="text/javascript" src="assets/google-code-prettify/prettify.js"></script>

		<!-- Required Modernizr file -->
		<script src="modernizr.custom.js"></script>
		<script src="local_resources/swfobject.js"></script>
	</head>
	<body class="deck-container timeline">

		<!-- Begin slides. Just make elements with a class of slide. -->

		<section class="slide wider">
		<h1>Embedded Timeline</h1>
		<iframe src="http://www.test.newsonline.tc.nca.bbc.co.uk/history/0/16435733"></iframe>
		</section>
		
		<!-- Quick Overview -->
		<section class="slide insterstitial">
		<h1>Overview</h1>
		</section>

		<section class="slide">
		<h1>BDD and best intentions</h1>
		<ul>
		  <li>Requires a protagonist to make use of BDD in the first place</li>
		  <li>Intention was to provide a specification starting point to iterate from
		    <blockquote>figuring out what the hell you are supposed to be building in the first place – I think that’s half the benefit</blockquote>
		    (Matt Wynne, co-author of the Cucumber book<br/>
		    <a href="http://rubysource.com/matt-wynne-on-using-cucumber/">http://rubysource.com/matt-wynne-on-using-cucumber/</a>)
		  </li>
		  <li>No BA - is that bad?</li>
		  <li>Stakeholders: Tom(s) from UX, Leo (PM) and developers (Kenny and Claudio)</li>
		</ul>
		</section>

		<section class="slide">
		<h1>Relish</h1>
		<iframe src="https://www.relishapp.com/bbc-knowlearn/history-embedded-timeline/docs/?token=xIfwm1VSMWomykv288EV"></iframe>
		</section>

		<section class="slide">
		<h1>Relish or Confluence?</h1>
		<h2>Relish</h2>
		<ul class="no-top-offset">
		  <li>Generated from source Gherkin == the truth</li>
		  <li>No ambiguity as not separately maintained</li>
		  <li>Nicely formatted == readable</li>
		  <li>Relish is a third party site</li>
		  <li>Requires relishapp command line tool (and a developer to drive it)</li>
		</ul>
		<h2>Confluence</h2>
		<ul class="no-top-offset">
		  <li>Allows wider stakeholder group to edit the feature scenarios</li>
		  <li>Is that a good thing? Should someone 'own' the scenarios?</li>
		</ul>
		</section>

		<section class="slide">
		<h1>The role of UX - waterfall?</h1>
		<ul>
		  <li>We have a production app that came out of a prototype to validate the concept - is that bad?
		    <div id="flashtimeline">
			<div id="flashcontent"><embed type="application/x-shockwave-flash" src="local_resources/new_scrub_08.swf" width="624" height="362" id="mymovie" name="mymovie" bgcolor="#ffffff" quality="high" menu="false"></div>
			<script type="text/javascript">
				var so = new SWFObject("local_resources/new_scrub_08.swf", "mymovie", "624", "362", "10", "#ffffff");
				so.write("flashcontent");
				so.addParam("menu", "false");
				so.write("flashcontent");
			</script>

		    </div>
		  </li>
		  <li>Is that the way we want to work?</li>
		  <li>Could we collaborate / iterate through feedback better?</li>
		</ul>
		</section>

		<section class="slide">
		<h1>Technical Architecture</h1>
		<div class="image-cradle">
			<img src="local_resources/architecture.png" width="800"/>	
		</div>
		</section>

		<!-- The Build -->
		<section class="slide insterstitial">
		<h1>The Build</h1>
		</section>
		
		<section class="slide">
		<h1>Running Cukes</h1>
		<iframe src="local_resources/cukes.html"></iframe>
		</section>

		<section class="slide">
		<h1>Jasmine Tests</h1>
		<iframe src="local_resources/timeline/specs/kltimeline.html"></iframe>
		</section>

		<section class="slide">
		<h1>Jasmine Example</h1>
		<pre class="prettyprint smaller">
<code class="language-javascript">
<div class="highlightable">describe('makeDraggable',function(){</div>
    <div class="highlightable">it('should return a new Draggable object that is also appended as a property to the timeline dom element',function(){</div>
      var graphicalTimeline = dummyTimeline(); 
      var draggableInstance = graphicalTimeline.makeDraggable();
      var draggableInstanceOnTimeline = graphicalTimeline.$timeline.get(0).draggableInstance;

      <div class="highlightable">      expect(draggableInstance).toBeAnInstanceOf(Draggable);</div>
      expect(draggableInstance).toEqual(draggableInstanceOnTimeline);
    });	

    it('should set dragInProgress to true when dragging is in progress',function(){
      var graphicalTimeline = dummyTimeline(); 
      var fireEvent = function(element,event){
        var e = document.createEvent("HTMLEvents");
        e.initEvent(event, true, true ); // event type,bubbling,cancelable
        return !element.dispatchEvent(e);
      }

      var timelineElement = graphicalTimeline.$timeline.get(0);
      fireEvent(timelineElement,'mousedown');
      fireEvent(timelineElement,'mousemove');

      expect(graphicalTimeline.dragInProgress).toEqual(true);    
    });
  });
</code></pre>
		</section>

	

		<article class="slide wider" id="unittest">
		    <h1>PHPUnit test strategy</h1>
		    <section>
		        <h2>Our humble aims</h2>
		        <ul>
		             <li>Test Models and Controllers</li>
		             <li>Coverage</li>
		             <li>Quality</li>
		        </ul>
		        
		        <h2>Jasmine tea time reading</h2>
		        <p><a htef="http://googletesting.blogspot.co.uk/2010/07/code-coverage-goal-80-and-no-less.html">
		        A Chinese parable on Unit tests
		        </a>
		        </p>		    
		    </section>
		    
		    <section>
		    <pre class="prettyprint">
		         <code class="language-php">
public function testLoadJsonThrowsExceptionWhenResponseIs404() {
    <div class="highlightable">
    $reflector = new ReflectionClass('Loader');
    $testMethod = $reflector->getMethod('_loadJson');
    $testMethod->setAccessible(true);</div>
    
    <div class="highlightable">
    $httpClient = $this->getMock('BBC_Http_Client');
    $httpResponse = new Zend_Http_Response(404, array(), 'test');
    $httpClient->expects($this->any())
    ->method('request')
    ->will($this->returnValue($httpResponse));
    </div>
    $this->_testLoader->setHttpClient($httpClient);
    try {
        $processedData = $testMethod->invoke($this->_testLoader);
    } catch (Exception $expected) {
        return;
    }
    <div class="highlightable">
    $this->fail('loadJson does not generate exception when response is 404');
    </div>
}
		      </pre> 
		         </code>
		    </section>
		</article>
		
		<!-- 
		<section class="slide wider">
		<h1>PHPUnit Tests Report</h1>
		<iframe src="local_resources/phpunit.html"></iframe>
		</section>
        -->
        
		<section class="slide wider">
		<h1>PHPUnit Tests Coverage</h1>
		<iframe src="local_resources/unit_test_coverage/index.html"></iframe>
		</section>
		
		<section class="slide wider">
			<h1>TDD Approach</h1>
	        <h2>Benefits:</h2>
	        <ul class="no-top-offset">
	            <li>Allows for a short feedback loop</li>
	            <li>Reduces time spent in debugging and refactoring</li>
	            <li>Increases reliability</li>
	            <li>Informs if last change has broken previously working code</li>
	            <li>Helps simplification of the code (small classes and decoupled code)</li>
	        </ul>
	        <h2>But...</h2>
	        <ul class="no-top-offset">
	            <li>Demands jesuitical commitment to the cause</li>
	        </ul>
        	</section>

		<section class="slide">
		<h1>Rake Tasks</h1>
<pre class="prettyprint">
> rake --tasks
rake buildjs                 # Optimize Javascript
rake ci:features             # Run Cukes in CI
rake features                # Run Cukes against localhost:4567 (Sinatra)
rake focus:features          # Run Cukes tagged @now against localhost:4567 (Sinatra)
rake int:features            # Run Cukes against INT
rake jasmine                 # Run specs via server
rake jasmine:ci              # Run continuous integration tests
rake phpunit                 # Run PHPUnit Tests
rake sandbox:features        # Run Cukes against Sandbox
rake sandbox:focus:features  # Run Cukes tagged @now against Sandbox
</pre>
		</section>

		<!-- JS Widget -->
		<section class="slide insterstitial">
		<h1>The JS Widget</h1>
		</section>

		<section class="slide narrower">
		<h1>Escaping the Sandbox</h1>
		<iframe src="local_resources/timeline/index.html"></iframe>
		</section>

		<section class="slide">
		<h1>This isn't a Carousel!</h1>
		<ul>
			<li>Firstly it doesn't go round.</li>
			<li>Parses the DOM for CSS selectors & creates data model</li>
			<li>Has an internal representation of state not held in the DOM</li>
			<li>Generates a view based on Mustache templates </li>
			<li>Built for flexibility so that Timeline 2.0 <del>can be</del> could have been built quickly!</li>
		</ul>
		</section>

		<section class="slide">
		<h1>JavaScript Libraries</h1>
		<ul>
			<li>Require.js: <a href="http://requirejs.org/">http://requirejs.org/</a></li>
			<li>Mustache: <a href="http://mustache.github.com/">http://mustache.github.com/</a></li>
			<li>ICanHaz: <a href="https://github.com/andyet/ICanHaz.js">https://github.com/andyet/ICanHaz.js </a>&nbsp;<a href="https://github.com/kenoir/ICanHaz.js">(Forked!)</a></li>
			<li>JQuery: <a href="http://jquery.com/">http://jquery.com/</a></li>
			<li><del>JQueryUI: <a href="http://jqueryui.com/">http://jqueryui.com</del></a></li>
			<li>drgbl.js <a href="https://github.com/kenoir/drgbl.js">https://github.com/kenoir/drgbl.js</a></li>
			<li>EventEmitter <a href="https://github.com/Wolfy87/EventEmitter/">https://github.com/Wolfy87/EventEmitter/</a></li>
			<li>Modernizr <a href="http://modernizr.com/">http://modernizr.com/</a></li>
		</ul>
		</section>

		<section class="slide narrower">
		<h1>Why not JQueryUI?</h1>
		<iframe src="local_resources/drgbl/index.html"></iframe>
		</section>

		<section class="slide">
		<h1>Responsive design & animation</h1>
		<div class="fancy-transform">

<pre class="prettyprint">
<code class="language-css">
/* We use Modernizr to check whether transform is
   available in the browser and apply a JavaScript
   animation if it's not ... */

.timeline .fancy-transform:hover {
     background-color:cyan;
     top:200px;
     
      -webkit-transform: scale(1.5,1.5) rotate( 20deg );
      -webkit-transition-duration: 0.5s;
}

/* But we can't be sure that this code will behave
   the same way in different versions of WebKit! */
</code>
</pre>
		</div>

		</section>

		<section class="slide">
		<h1>Lessons learnt</h1>
		<ul>
			<li><a href="http://pivotal.github.com/jasmine/">Jasmine</a> is awesome.</li>
			<li>It might have been OK to throw away JQuery.</li>
			<li>A JavaScript MVC framework might have helped.</li> 
			<li>CSS3 rendering engines are not to be trusted.</li>
			<li>Making asynchronous requests between www & static doesn't work. <br/> See:
				<a href="http://www.w3.org/TR/cors/">
					<ABBR TITLE="Cross Origin Request Sharing">CORS</ABBR>
				</a>
			</li>
			<li>'Responsive design' means 'lots and lots of work for web developers'.</li>
			<li>Testing JavaScript in CI (without a PAL app) is hard.</li>
		</ul>
		</section>

		<!-- The PAL Application -->
		<section class="slide insterstitial">
		<h1>The PAL App</h1>
		</section>

		<section class="slide">
		<h1>Our aims were (and are):</h1>
		<ul>
		    <li>Keep it simple</li>
		    <li>Make a decoupled application</li>
		    <li>Data source can be swapped out</li>
		    <li>Can be easily switched into a shared module (BBC Module)</li>
		    <li>Data source parser can be made into an interface with multiple implementations</li>
		    <li>A new implementation can be an RDF/XML parser</li>
		</ul>
		</section>
	
		<section class="slide">
		<h1>The PAL App Structure</h1>
	    	<iframe src="local_resources/phpdocs/index.html"></iframe>
		</section>

		<!-- The PAL Application -->
		<section class="slide insterstitial">
		<h1>Non-Functional Requirements</h1>
		</section>
	
		<section class="slide">
		<h1>Zenoss Monitoring</h2>
		<iframe src="https://monitor.forge.bbc.co.uk/zport/dmd/Reports/Multi-Graph%20Reports/BBC%20Applications/kltimeline/kltimeline_Int#graph_3:True;"></iframe>
		<!--
			<div class="image-cradle">
				<h2>Zenoss</h2>
				<img src="local_resources/zenoss.png" width="800"/>	
			</div>
			<ul style="top: 20px;">
				<li>Thing that we are monitoring in Zenoss</li>
				<li>...</li>
			</ul>
		</div>
		-->
		</section>
		
		<article class="slide wider" id="monitoring">
			<h1>What we monitor</h1>
			<section>
				<ul class="no-top-offset">
				    <li>404s</li>
					<li>Service errors</li>
					<li>Unexistent Timeline resource</li>
					<li>Invalid Timeline Json feed:
					    <ul style="top: 5px; left: 5px;">
					      <li>Malformatted json</li>
					      <li>No timeline properties</li>
					      <li>No events etc.</li>
					    </ul>
					</li>
				</ul>
			</section>
			<section>
				<pre class="prettyprint no-top-offset"><code>; monitoring
						<div class="highlightable">
						kltimeline.monitoring.error404.thresholds.maxThreshW = 3
						kltimeline.monitoring.error404.thresholds.maxThreshI = 1.5
						kltimeline.monitoring.error404.thresholds.maxThreshD = 0.3
						</div><div class="highlightable">
						kltimeline.monitoring.error500.thresholds.maxThreshW = 3
						kltimeline.monitoring.error500.thresholds.maxThreshI = 1.5
						kltimeline.monitoring.error500.thresholds.maxThreshD = 0.3
						</div><div class="highlightable">
						kltimeline.monitoring.error503.thresholds.maxThreshW = 3
						kltimeline.monitoring.error503.thresholds.maxThreshI = 1.5
						kltimeline.monitoring.error503.thresholds.maxThreshD = 0.3
						</div><div class="highlightable">
						kltimeline.monitoring.errorServiceInvalidData.thresholds.maxThreshW = 3
						kltimeline.monitoring.errorServiceInvalidData.thresholds.maxThreshI = 1.5
						kltimeline.monitoring.errorServiceInvalidData.thresholds.maxThreshD = 0.3		
						</div>
				    </code>
				</pre>
			</section>
		</article>		
		
		<section class="slide">
		<h1>Logging</h1>
		<p></p>
		</div>
		</section>
		
		<section class="slide">
		<h1>Logging errors to console</h1>
		</div>
		</section>
		
		
		<section class="slide">
		<h1>Logging actions with iStats</h1>
<pre class="prettyprint">
<code class="language-javascript">
dragend: function(){
  var logData = { 
    'eventResourceURL' : 
      carousel.focussedEvent().timelineEvent.resourceURL 
  };

  Stats.log('dragged.timeline.kltimeline',logData);
}
</code>
</pre>
		<div class="quicknote">
			<p><a href="http://www.bbc.co.uk/frameworks/istats/guides/logging-actions">http://www.bbc.co.uk/frameworks/istats/guides/logging-actions</a></p>
		</div>
		</section>

		<section class="slide">
		<h1>Caching</h1>
		<h2>mod_cache on the News Stack</h2>
		<div class="quicknote">
			<p><a href="https://confluence.dev.bbc.co.uk/display/frameworks/Sharing+PAL+Content+with+News+Stack">https://confluence.dev.bbc.co.uk/display/frameworks/Sharing+PAL+Content+with+News+Stack</a></p>

		</div>
		</section>
		<!-- End slides. -->

		<!-- Begin extension snippets. Add or remove as needed. -->

		<!-- deck.navigation snippet -->
		<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
		<a href="#" class="deck-next-link" title="Next">&#8594;</a>

		<!-- deck.status snippet -->
		<p class="deck-status">
		<span onclick="$.deck('toggleMenu');">&#21512;</span>
		<span class="deck-status-current"></span>
		/
		<span class="deck-status-total"></span>
		</p>

		<!-- deck.goto snippet -->
		<form action="." method="get" class="goto-form">
			<label for="goto-slide">Go to slide:</label>
			<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
			<datalist id="goto-datalist"></datalist>
			<input type="submit" value="Go">
		</form>

		<!-- deck.hash snippet -->
		<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

		<!-- End extension snippets. -->


		<!-- Required JS files. -->
		<script src="jquery-1.7.2.min.js"></script>
		<script src="core/deck.core.js"></script>

		<!-- Extension JS files. Add or remove as needed. -->
		<script src="core/deck.core.js"></script>
		<script src="extensions/hash/deck.hash.js"></script>
		<script src="extensions/menu/deck.menu.js"></script>
		<script src="extensions/goto/deck.goto.js"></script>
		<script src="extensions/status/deck.status.js"></script>
		<script src="extensions/navigation/deck.navigation.js"></script>

		<!-- Initialize the deck. You can put this in an external file if desired. -->
		<script>
			$(function() {
				$.deck('.slide');
				prettyPrint();
			});
		</script>
	</body>
</html>
